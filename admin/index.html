<!doctype html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN | SUARAKAN Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 600: '#1A56DB', 700: '#1e40af', 800: '#1e3a8a', 900: '#172554' },
                        dark: { bg: '#0F172A', card: '#1E293B', border: '#334155' }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass-effect { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); }
        .dark .glass-effect { background: rgba(15, 23, 42, 0.8); }
    </style>
</head>
<body class="bg-slate-50 dark:bg-dark-bg text-slate-900 dark:text-slate-100 min-h-screen">

    <div id="loginOverlay" class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900 px-4">
        <div class="bg-white dark:bg-dark-card p-8 rounded-[2.5rem] shadow-2xl w-full max-w-md border dark:border-dark-border text-center">
            <div class="w-16 h-16 bg-brand-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                <i class="fa-solid fa-lock text-white text-2xl"></i>
            </div>
            <h2 class="text-2xl font-black mb-2">Admin Login</h2>
            <p class="text-sm text-slate-500 mb-6">Masukkan kata sandi akses pengelola</p>
            <input type="password" id="adminPass" class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl p-4 text-center text-lg font-mono outline-none focus:ring-2 ring-brand-600 mb-4" placeholder="••••••">
            <button onclick="checkAdminLogin()" class="w-full bg-brand-600 hover:bg-brand-700 text-white font-black py-4 rounded-2xl transition">MASUK DASHBOARD</button>
        </div>
    </div>

    <nav class="fixed top-0 w-full z-50 glass-effect border-b border-slate-200 dark:border-dark-border">
        <div class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-brand-600 rounded-xl flex items-center justify-center">
                    <i class="fa-solid fa-user-shield text-white text-sm"></i>
                </div>
                <span class="font-extrabold text-lg tracking-tight uppercase">ADMIN<span class="text-brand-600">PANEL</span></span>
            </div>
            <button onclick="location.reload()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition">
                <i class="fa-solid fa-rotate text-slate-500"></i>
            </button>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-6 max-w-5xl mx-auto">
        <div class="mb-8 flex justify-between items-end">
            <div>
                <h1 class="text-3xl font-black tracking-tight">Daftar Aspirasi</h1>
                <p class="text-slate-500 text-sm">Kelola dan jawab suara siswa di sini.</p>
            </div>
            <div id="countBadge" class="bg-brand-100 dark:bg-brand-900/30 text-brand-600 px-4 py-1 rounded-full text-xs font-bold border border-brand-200">
                0 Laporan
            </div>
        </div>

        <div id="adminList" class="space-y-4">
            <div class="animate-pulse flex flex-col gap-4">
                <div class="h-32 bg-slate-200 dark:bg-slate-800 rounded-3xl"></div>
                <div class="h-32 bg-slate-200 dark:bg-slate-800 rounded-3xl"></div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, doc, updateDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBcQNA82YJdc5dBSu2u26ZEAdkPjC0ZXD0",
            authDomain: "suarakita-da4aa.firebaseapp.com",
            projectId: "suarakita-da4aa",
            storageBucket: "suarakita-da4aa.firebasestorage.app",
            messagingSenderId: "700457706038",
            appId: "1:700457706038:web:a47d94dbd81ad602feee97"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Simple Login Check (Password: osim123)
        window.checkAdminLogin = () => {
            const pass = document.getElementById('adminPass').value;
            if(pass === "osim123") { // GANTI PASSWORD DI SINI
                document.getElementById('loginOverlay').classList.add('hidden');
                loadReports();
            } else {
                alert("Password Salah!");
            }
        };

        async function loadReports() {
            const list = document.getElementById('adminList');
            const badge = document.getElementById('countBadge');
            
            try {
                const q = query(collection(db, "laporan"), where("status", "==", "Diproses"), orderBy("createdAt", "desc"));
                const snap = await getDocs(q);
                
                list.innerHTML = "";
                badge.innerText = `${snap.size} Laporan Pending`;

                if(snap.empty) {
                    list.innerHTML = `<div class="text-center py-20 opacity-50"><i class="fa-solid fa-check-circle text-4xl mb-3"></i><p>Semua aspirasi sudah dijawab!</p></div>`;
                    return;
                }

                snap.forEach((d) => {
                    const data = d.data();
                    const id = d.id;
                    const time = data.createdAt?.toDate().toLocaleString('id-ID') || "-";
                    
                    const card = `
                        <div class="bg-white dark:bg-dark-card border border-slate-200 dark:border-dark-border rounded-[2rem] p-6 shadow-sm">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <span class="text-[10px] font-black uppercase tracking-widest text-brand-600 bg-brand-50 px-2 py-1 rounded-md">${data.kategori}</span>
                                    <p class="text-[10px] text-slate-400 mt-1 font-mono">${id} • ${time}</p>
                                </div>
                                <span class="text-[10px] font-bold px-3 py-1 rounded-full ${data.urgensi === 'Tinggi' ? 'bg-red-100 text-red-600' : 'bg-slate-100 text-slate-600'}">${data.urgensi}</span>
                            </div>
                            <p class="text-slate-700 dark:text-slate-300 font-medium mb-6">"${data.pesan}"</p>
                            
                            <div class="space-y-3">
                                <textarea id="text-${id}" class="w-full bg-slate-50 dark:bg-slate-800 border-none rounded-2xl p-4 text-sm outline-none focus:ring-2 ring-brand-600" placeholder="Ketik tanggapan resmi..."></textarea>
                                <button onclick="window.submitReply('${id}')" class="w-full bg-slate-900 dark:bg-brand-600 text-white font-bold py-3 rounded-xl hover:opacity-90 transition">KIRIM TANGGAPAN</button>
                            </div>
                        </div>
                    `;
                    list.innerHTML += card;
                });
            } catch (e) {
                list.innerHTML = `<p class="text-red-500 text-center">Error: ${e.message}</p>`;
            }
        }

        window.submitReply = async (id) => {
            const replyText = document.getElementById(`text-${id}`).value;
            if(!replyText) return alert("Jawaban tidak boleh kosong!");

            if(confirm("Kirim tanggapan ini? Status akan berubah menjadi SELESAI.")) {
                try {
                    await updateDoc(doc(db, "laporan", id), {
                        tanggapan: replyText,
                        status: "Selesai"
                    });
                    alert("Berhasil dijawab!");
                    loadReports();
                } catch (e) {
                    alert("Gagal update!");
                }
            }
        };
    </script>
</body>
</html>
